<div class="example-extension-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Random Events</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div class="example-extension_block flex-container">
                <input id="disabled_setting" type="checkbox" />
                <label for="disabled_setting">Disabled</label>
            </div>
            <div class="example-extension_block flex-container">
                <input id="ai_events_setting" type="checkbox" />
                <label for="ai_events_setting">AI Events</label>
            </div>

            <div class="example-extension_block flex-container">
                <label for="eventFolders">Select Event Folder:</label>
                <select id="eventFolders" name="folders" onchange="loadEventsForFolder()">
                </select>
            
                <hr class="sysHR" />
            
                <label for="eventItems">All Events:</label>
                <div id="debugLabel"></div>
                <select id="eventItems" name="items">
                </select>
            
                <hr class="sysHR" />
            
                <label for="newEventName">Enter Event Name:</label>
                <input type="text" id="newEventName" placeholder="Enter a new event name">
            
                <button id="newEventItemsButton" onclick="addItem()">Add Event</button>
                <button id="deleteItemButton" onclick="deleteItem()">Delete Event</button>
            
                <button id="saveToFileButton" onclick="saveEventsToFile()">Save to File</button>
                <script>
                    // Function to get the relative path based on the current URL
                    function getRelativePath() {
                        var pathArray = window.location.pathname.split('/');
                        pathArray.pop(); // Remove the last element (current HTML file)
                        return pathArray.join('/') + '/';
                    }
                
                    function addItem() {
                        var newItemName = document.getElementById("newEventName").value;
                        if (newItemName.trim() !== "") {
                            var select = document.getElementById("eventItems");
                            var option = document.createElement("option");
                            option.value = newItemName;  // Preserve case and spaces
                            option.text = newItemName;
                            select.add(option);
                            document.getElementById("newEventName").value = "";
                
                            // Save the added item to local storage
                            saveEvent(newItemName);
                        }
                    }
                
                    function saveEvent(eventName) {
                        var selectedFolder = document.getElementById("eventFolders").value;
                        var savedEvents = JSON.parse(localStorage.getItem(selectedFolder)) || [];
                        savedEvents.push(eventName);
                        localStorage.setItem(selectedFolder, JSON.stringify(savedEvents));
                
                        // Save the events to the corresponding file
                        saveEventsToFile(selectedFolder, savedEvents);
                    }
                
                    function deleteItem() {
                        var select = document.getElementById("eventItems");
                        var selectedIndex = select.selectedIndex;
                
                        if (selectedIndex !== -1) {
                            var deletedItem = select.options[selectedIndex].value;
                
                            // Remove the selected item from the dropdown
                            select.remove(selectedIndex);
                
                            // Remove the selected item from the saved events in local storage
                            removeEventFromStorage(deletedItem);
                        }
                    }
                
                    function removeEventFromStorage(event) {
                        var selectedFolder = document.getElementById("eventFolders").value;
                        var savedEvents = JSON.parse(localStorage.getItem(selectedFolder)) || [];
                        var updatedEvents = savedEvents.filter(function (savedEvent) {
                            return savedEvent !== event;
                        });
                        localStorage.setItem(selectedFolder, JSON.stringify(updatedEvents));
                
                        // Save the updated events to the corresponding file
                        saveEventsToFile(selectedFolder, updatedEvents);
                    }
                
                    function loadEventsForFolder() {
                        var selectedFolder = document.getElementById("eventFolders").value;
                        var savedEvents = JSON.parse(localStorage.getItem(selectedFolder)) || [];
                
                        // Clear the existing options in the eventItems dropdown
                        var eventItemsSelect = document.getElementById("eventItems");
                        eventItemsSelect.innerHTML = "";
                
                        // Populate the eventItems dropdown with events from the selected folder
                        savedEvents.forEach(function (event) {
                            var option = document.createElement("option");
                            option.value = event;
                            option.text = event;
                            eventItemsSelect.add(option);
                        });
                
                        // Update the debug label with the file path
                        document.getElementById("debugLabel").innerText = "File Path: " + getRelativePath() + selectedFolder + '/' + selectedFolder + '_events.json';
                    }
                
                    function loadFolders() {
                        // Get all folders from local storage
                        var folders = Object.keys(localStorage);
                
                        // Clear the existing options in the eventFolders dropdown
                        var eventFoldersSelect = document.getElementById("eventFolders");
                        eventFoldersSelect.innerHTML = "";
                
                        // Populate the eventFolders dropdown with folder names
                        folders.forEach(function (folder) {
                            var option = document.createElement("option");
                            option.value = folder;
                            option.text = folder;
                            eventFoldersSelect.add(option);
                        });
                
                        // Load events for the selected folder
                        loadEventsForFolder();
                    }
                
                    function saveEventsToFile(folder, events) {
                        // Save the events to the corresponding file
                        var filePath = folder + '/' + folder + '_events.json';
                        var blob = new Blob([JSON.stringify(events)], { type: 'application/json' });
                        var a = document.createElement('a');
                        a.href = URL.createObjectURL(blob);
                        a.download = filePath;
                        a.click();
                    }
                
                    // Load folders when the extension is loaded
                    loadFolders();
                </script>
                
                
            </div>
            
            

            <hr class="sysHR" />
        </div>
    </div>
</div>